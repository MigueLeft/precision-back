{
	"info": {
		"_postman_id": "b2c3d4e5-6789-0123-4567-890123456789",
		"name": "Sistema M√©dico - Parte 2: Patients, Medics & Appointments",
		"description": "Colecci√≥n de pruebas para m√≥dulos de pacientes, m√©dicos y citas con validaciones de estados y transiciones",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "üè• Patients Management",
			"description": "Gesti√≥n completa de pacientes con validaciones de negocio",
			"item": [
				{
					"name": "‚úÖ Create Patient - Success",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstName\": \"Mar√≠a\",\n  \"lastName\": \"Gonz√°lez\",\n  \"identification\": \"12345678\",\n  \"phone\": \"+57 300 123 4567\",\n  \"email\": \"maria.gonzalez@email.com\",\n  \"birthdate\": \"1990-05-15T00:00:00.000Z\",\n  \"gender\": \"Femenino\",\n  \"active\": true\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/patients",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"patients"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201 Created\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Response has patient data structure\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', true);",
									"    pm.expect(jsonData).to.have.property('data');",
									"    pm.expect(jsonData.data).to.have.property('id');",
									"    pm.expect(jsonData.data).to.have.property('firstName', 'Mar√≠a');",
									"    pm.expect(jsonData.data).to.have.property('lastName', 'Gonz√°lez');",
									"    pm.expect(jsonData.data).to.have.property('email', 'maria.gonzalez@email.com');",
									"    pm.expect(jsonData.data).to.have.property('gender', 'Femenino');",
									"    pm.expect(jsonData.data).to.have.property('active', true);",
									"    ",
									"    // Guardar ID para siguientes requests",
									"    pm.globals.set(\"patientId\", jsonData.data.id);",
									"});",
									"",
									"pm.test(\"Patient has medical fields\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data).to.have.property('identification');",
									"    pm.expect(jsonData.data).to.have.property('birthdate');",
									"    pm.expect(jsonData.data).to.have.property('phone');",
									"    pm.expect(jsonData.data).to.have.property('gender');",
									"});",
									"",
									"pm.test(\"Date of birth is properly formatted\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data).to.have.property('birthdate');",
									"    var birthDate = new Date(jsonData.data.birthdate);",
									"    pm.expect(birthDate.getFullYear()).to.equal(1990);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "‚úÖ Create Patient - Pediatric",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstName\": \"Ana\",\n  \"lastName\": \"Mart√≠nez\",\n  \"identification\": \"87654321\",\n  \"phone\": \"+57 300 987 6543\",\n  \"email\": \"ana.martinez@email.com\",\n  \"birthdate\": \"2015-03-20T00:00:00.000Z\",\n  \"gender\": \"Femenino\",\n  \"active\": true\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/patients",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"patients"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Pediatric patient created successfully\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"if (pm.response.code === 201) {",
									"    var jsonData = pm.response.json();",
									"    pm.globals.set(\"pediatricPatientId\", jsonData.data.id);",
									"    ",
									"    pm.test(\"Patient is under 18 (pediatric)\", function () {",
									"        var birthDate = new Date(jsonData.data.dateOfBirth);",
									"        var today = new Date();",
									"        var age = today.getFullYear() - birthDate.getFullYear();",
									"        pm.expect(age).to.be.below(18);",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "‚ùå Create Patient - Duplicate Email",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstName\": \"Carlos\",\n  \"lastName\": \"Duplicate\",\n  \"email\": \"maria.gonzalez@email.com\",\n  \"phone\": \"+9876543210\",\n  \"dateOfBirth\": \"1985-01-01\",\n  \"gender\": \"male\",\n  \"active\": true\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/patients",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"patients"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 409 Conflict\", function () {",
									"    pm.response.to.have.status(409);",
									"});",
									"",
									"pm.test(\"Error message about duplicate email\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', false);",
									"    pm.expect(jsonData.message.toLowerCase()).to.include('email');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "‚ùå Create Patient - Future Birth Date",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstName\": \"Sofia\",\n  \"lastName\": \"Martinez\",\n  \"identification\": \"87654321\",\n  \"email\": \"sofia.martinez@email.com\",\n  \"phone\": \"+57 301 987 6543\",\n  \"birthdate\": \"2020-12-31T00:00:00.000Z\",\n  \"gender\": \"Femenino\",\n  \"active\": true\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/patients",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"patients"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 400 Bad Request\", function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test(\"Validation error for future birth date\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', false);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "‚úÖ Get All Patients - With Filters",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/patients?page=1&limit=10&gender=Femenino&active=true&sortBy=lastName&sortOrder=asc",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"patients"
							],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "limit",
									"value": "10"
								},
								{
									"key": "gender",
									"value": "female"
								},
								{
									"key": "active",
									"value": "true"
								},
								{
									"key": "sortBy",
									"value": "lastName"
								},
								{
									"key": "sortOrder",
									"value": "asc"
								}
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"All patients are female and active\", function () {",
									"    var jsonData = pm.response.json();",
									"    jsonData.data.forEach(function(patient) {",
									"        pm.expect(patient.gender).to.equal('female');",
									"        pm.expect(patient.active).to.be.true;",
									"    });",
									"});",
									"",
									"pm.test(\"Patients are sorted by lastName ascending\", function () {",
									"    var jsonData = pm.response.json();",
									"    if (jsonData.data.length > 1) {",
									"        for (let i = 1; i < jsonData.data.length; i++) {",
									"            pm.expect(jsonData.data[i].lastName >= jsonData.data[i-1].lastName).to.be.true;",
									"        }",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "‚úÖ Search Patients by Name",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/patients?search=mar√≠a&sortBy=firstName&sortOrder=asc",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"patients"
							],
							"query": [
								{
									"key": "search",
									"value": "mar√≠a"
								},
								{
									"key": "active",
									"value": "true"
								}
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Search results contain 'mar√≠a'\", function () {",
									"    var jsonData = pm.response.json();",
									"    if (jsonData.data.length > 0) {",
									"        jsonData.data.forEach(function(patient) {",
									"            var searchMatch = patient.firstName.toLowerCase().includes('mar√≠a') || ",
									"                            patient.lastName.toLowerCase().includes('mar√≠a') ||",
									"                            patient.email.toLowerCase().includes('mar√≠a');",
									"            pm.expect(searchMatch).to.be.true;",
									"        });",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "‚úÖ Get Patient by ID",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/patients/{{patientId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"patients",
								"{{patientId}}"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has complete patient data\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', true);",
									"    pm.expect(jsonData.data).to.have.property('id', pm.globals.get('patientId'));",
									"    pm.expect(jsonData.data).to.have.property('firstName');",
									"    pm.expect(jsonData.data).to.have.property('lastName');",
									"    pm.expect(jsonData.data).to.have.property('identification');",
									"    pm.expect(jsonData.data).to.have.property('gender');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "‚úÖ Update Patient - Medical Information",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"medicalHistory\": \"Actualizaci√≥n: Hipertensi√≥n controlada con medicaci√≥n\",\n  \"allergies\": \"Al√©rgica a penicilina y aspirina\",\n  \"emergencyContact\": \"Juan Gonz√°lez - +0987654321 (Actualizado)\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/patients/{{patientId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"patients",
								"{{patientId}}"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Medical information updated correctly\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data.medicalHistory).to.include('Hipertensi√≥n controlada');",
									"    pm.expect(jsonData.data.allergies).to.include('penicilina y aspirina');",
									"    pm.expect(jsonData.data.emergencyContact).to.include('Actualizado');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "‚úÖ Assign User to Patient",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"userId\": \"{{userId}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/patients/{{patientId}}/assign-user",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"patients",
								"{{patientId}}",
								"assign-user"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"User assigned to patient successfully\", function () {",
									"    pm.expect([200, 400, 404]).to.include(pm.response.code);",
									"    // 200: Success, 400: User already assigned, 404: User not found",
									"});",
									"",
									"if (pm.response.code === 200) {",
									"    pm.test(\"Patient now has assigned user\", function () {",
									"        var jsonData = pm.response.json();",
									"        pm.expect(jsonData.data).to.have.property('userId');",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "‚ùå Create Patient - Future Birthdate Error",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstName\": \"Future\",\n  \"lastName\": \"Baby\",\n  \"identification\": \"99999999\",\n  \"email\": \"future.baby@email.com\",\n  \"phone\": \"+57 301 999 9999\",\n  \"birthdate\": \"2026-05-15T00:00:00.000Z\",\n  \"gender\": \"Femenino\",\n  \"active\": true\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/patients",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"patients"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 400 - Validation Error\", function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test(\"Error message indicates future birthdate is not allowed\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', false);",
									"    pm.expect(jsonData).to.have.property('message');",
									"    ",
									"    // Verificar que el mensaje menciona fecha futura",
									"    var message = jsonData.message.toLowerCase();",
									"    pm.expect(message).to.satisfy(function(msg) {",
									"        return msg.includes('futuro') || msg.includes('future') || msg.includes('birthdate');",
									"    }, 'Error message should mention future date validation');",
									"});",
									"",
									"pm.test(\"Response structure is correct for validation error\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('timestamp');",
									"    pm.expect(jsonData.success).to.be.false;",
									"});",
									"",
									"console.log('‚úÖ Future birthdate validation working correctly');"
								],
								"type": "text/javascript"
							}
						}
					]
				}
			]
		},
		{
			"name": "üë®‚Äç‚öïÔ∏è Medics Management",
			"description": "Gesti√≥n de m√©dicos con especialidades y validaciones",
			"item": [
				{
					"name": "‚úÖ Create Medic - Cardiologist",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"Carlos\",\n  \"lastName\": \"Rodr√≠guez\",\n  \"identification\": \"98765432\",\n  \"phone\": \"+57 300 456 7890\",\n  \"email\": \"carlos.rodriguez@hospital.com\",\n  \"registrationNumber\": \"MED-12345\",\n  \"specialty\": \"Cardiolog√≠a\",\n  \"professionalTitle\": \"M√©dico Especialista en Cardiolog√≠a\",\n  \"active\": true\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/medics",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"medics"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201 Created\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Response has medic data structure\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', true);",
									"    pm.expect(jsonData).to.have.property('data');",
									"    pm.expect(jsonData.data).to.have.property('id');",
									"    pm.expect(jsonData.data).to.have.property('name', 'Carlos');",
									"    pm.expect(jsonData.data).to.have.property('lastName', 'Rodr√≠guez');",
									"    pm.expect(jsonData.data).to.have.property('specialty', 'Cardiolog√≠a');",
									"    pm.expect(jsonData.data).to.have.property('registrationNumber', 'MED-12345');",
									"    pm.expect(jsonData.data).to.have.property('identification');",
									"    pm.expect(jsonData.data).to.have.property('active', true);",
									"    ",
									"    // Guardar ID para siguientes requests",
									"    pm.globals.set(\"medicId\", jsonData.data.id);",
									"});",
									"",
									"pm.test(\"Medic has professional information\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data).to.have.property('certifications');",
									"    pm.expect(jsonData.data.certifications).to.be.an('array');",
									"    pm.expect(jsonData.data.certifications.length).to.be.above(0);",
									"    pm.expect(jsonData.data).to.have.property('languagesSpoken');",
									"    pm.expect(jsonData.data).to.have.property('professionalTitle');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "‚úÖ Create Medic - Pediatrician",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"Ana\",\n  \"lastName\": \"Garc√≠a\",\n  \"identification\": \"11223344\",\n  \"phone\": \"+57 300 555 1234\",\n  \"email\": \"ana.garcia@hospital.com\",\n  \"registrationNumber\": \"MED-67890\",\n  \"specialty\": \"Pediatr√≠a\",\n  \"professionalTitle\": \"M√©dico Especialista en Pediatr√≠a\",\n  \"active\": true\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/medics",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"medics"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Pediatrician created successfully\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"if (pm.response.code === 201) {",
									"    var jsonData = pm.response.json();",
									"    pm.globals.set(\"pediatricianId\", jsonData.data.id);",
									"    ",
									"    pm.test(\"Pediatrician has correct specialty\", function () {",
									"        pm.expect(jsonData.data.specialty).to.equal('Pediatr√≠a');",
									"        pm.expect(jsonData.data.consultationFee).to.equal(120);",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "‚ùå Create Medic - Duplicate License",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"Duplicate\",\n  \"lastName\": \"License\",\n  \"identification\": \"99999999\",\n  \"phone\": \"+57 300 999 9999\",\n  \"email\": \"duplicate@hospital.com\",\n  \"registrationNumber\": \"MED-12345\",\n  \"specialty\": \"Medicina General\",\n  \"professionalTitle\": \"M√©dico General\",\n  \"active\": true\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/medics",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"medics"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 409 Conflict\", function () {",
									"    pm.response.to.have.status(409);",
									"});",
									"",
									"pm.test(\"Error message about duplicate license\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', false);",
									"    pm.expect(jsonData.message.toLowerCase()).to.include('license');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "‚úÖ Get All Medics - By Specialty",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/medics?specialty=Cardiolog√≠a&active=true&sortBy=yearsOfExperience&sortOrder=desc",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"medics"
							],
							"query": [
								{
									"key": "specialty",
									"value": "Cardiolog√≠a"
								},
								{
									"key": "active",
									"value": "true"
								},
								{
									"key": "sortBy",
									"value": "yearsOfExperience"
								},
								{
									"key": "sortOrder",
									"value": "desc"
								}
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"All medics are cardiologists and active\", function () {",
									"    var jsonData = pm.response.json();",
									"    jsonData.data.forEach(function(medic) {",
									"        pm.expect(medic.specialty).to.equal('Cardiolog√≠a');",
									"        pm.expect(medic.active).to.be.true;",
									"    });",
									"});",
									"",
									"pm.test(\"Medics sorted by experience descending\", function () {",
									"    var jsonData = pm.response.json();",
									"    if (jsonData.data.length > 1) {",
									"        for (let i = 1; i < jsonData.data.length; i++) {",
									"            pm.expect(jsonData.data[i].yearsOfExperience <= jsonData.data[i-1].yearsOfExperience).to.be.true;",
									"        }",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "‚úÖ Get Medic by ID",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/medics/{{medicId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"medics",
								"{{medicId}}"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has complete medic data\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data).to.have.property('id', pm.globals.get('medicId'));",
									"    pm.expect(jsonData.data).to.have.property('firstName');",
									"    pm.expect(jsonData.data).to.have.property('specialty');",
									"    pm.expect(jsonData.data).to.have.property('licenseNumber');",
									"    pm.expect(jsonData.data).to.have.property('certifications');",
									"    pm.expect(jsonData.data).to.have.property('consultationFee');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "‚úÖ Update Medic - Consultation Fee",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"consultationFee\": 175.00,\n  \"biography\": \"Especialista en cardiolog√≠a con 10 a√±os de experiencia. Actualizaci√≥n de honorarios 2024.\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/medics/{{medicId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"medics",
								"{{medicId}}"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Consultation fee updated correctly\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data.consultationFee).to.equal(175);",
									"    pm.expect(jsonData.data.biography).to.include('2024');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				}
			]
		},
		{
			"name": "üìÖ Appointments Management",
			"description": "Gesti√≥n de citas con validaciones de estados y transiciones",
			"item": [
				{
					"name": "‚úÖ Create Appointment - Pending State",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"patientId\": \"{{patientId}}\",\n  \"medicId\": \"{{medicId}}\",\n  \"dateTime\": \"2024-12-15T10:00:00.000Z\",\n  \"appointmentType\": \"first_time\",\n  \"appointmentStatus\": \"pending\",\n  \"reason\": \"Consulta cardiol√≥gica inicial\",\n  \"notes\": \"Primera consulta, paciente refiere dolor en el pecho\",\n  \"requiresFollowUp\": true,\n  \"followUpDate\": \"2024-12-22T10:00:00.000Z\",\n  \"followUpPriority\": \"NORMAL\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/appointments",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"appointments"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201 Created\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Appointment created with correct data\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', true);",
									"    pm.expect(jsonData.data).to.have.property('id');",
									"    pm.expect(jsonData.data).to.have.property('patientId', pm.globals.get('patientId'));",
									"    pm.expect(jsonData.data).to.have.property('medicId', pm.globals.get('medicId'));",
									"    pm.expect(jsonData.data).to.have.property('appointmentType', 'first_time');",
									"    pm.expect(jsonData.data).to.have.property('appointmentStatus', 'pending');",
									"    pm.expect(jsonData.data).to.have.property('requiresFollowUp', true);",
									"    ",
									"    // Guardar ID para siguientes requests",
									"    pm.globals.set(\"appointmentId\", jsonData.data.id);",
									"});",
									"",
									"pm.test(\"Appointment has follow-up configuration\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data).to.have.property('followUpDate');",
									"    pm.expect(jsonData.data).to.have.property('followUpPriority', 'NORMAL');",
									"});",
									"",
									"pm.test(\"DateTime is properly formatted\", function () {",
									"    var jsonData = pm.response.json();",
									"    var appointmentDate = new Date(jsonData.data.dateTime);",
									"    pm.expect(appointmentDate.getFullYear()).to.equal(2024);",
									"    pm.expect(appointmentDate.getMonth()).to.equal(11); // December (0-indexed)",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "‚úÖ State Transition - Pending to Scheduled",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"appointmentStatus\": \"scheduled\",\n  \"notes\": \"Cita confirmada por el paciente y programada en el sistema\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/appointments/{{appointmentId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"appointments",
								"{{appointmentId}}"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Appointment status updated to scheduled\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data).to.have.property('appointmentStatus', 'scheduled');",
									"    pm.expect(jsonData.data.notes).to.include('confirmada');",
									"});",
									"",
									"pm.test(\"UpdatedAt timestamp changed\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data).to.have.property('updatedAt');",
									"    pm.expect(new Date(jsonData.data.updatedAt) > new Date(jsonData.data.createdAt)).to.be.true;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "‚úÖ State Transition - Scheduled to Completed",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"appointmentStatus\": \"completed\",\n  \"notes\": \"Consulta realizada exitosamente. Paciente evaluado completamente. Se recomienda seguimiento en 2 semanas.\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/appointments/{{appointmentId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"appointments",
								"{{appointmentId}}"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Appointment status updated to completed\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data).to.have.property('appointmentStatus', 'completed');",
									"    pm.expect(jsonData.data.notes).to.include('exitosamente');",
									"});",
									"",
									"pm.test(\"Completed appointment ready for follow-up\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data.requiresFollowUp).to.be.true;",
									"    pm.expect(jsonData.data).to.have.property('followUpDate');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "‚ùå Invalid State Transition - Completed to Pending",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"appointmentStatus\": \"pending\",\n  \"notes\": \"Intento de transici√≥n inv√°lida\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/appointments/{{appointmentId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"appointments",
								"{{appointmentId}}"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 400 Bad Request for invalid transition\", function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test(\"Error message about invalid state transition\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', false);",
									"    pm.expect(jsonData.message.toLowerCase()).to.include('transition');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "‚úÖ Create Pediatric Appointment",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"patientId\": \"{{pediatricPatientId}}\",\n  \"medicId\": \"{{pediatricianId}}\",\n  \"dateTime\": \"2024-12-16T14:00:00.000Z\",\n  \"appointmentType\": \"follow_up\",\n  \"appointmentStatus\": \"scheduled\",\n  \"reason\": \"Control pedi√°trico rutinario\",\n  \"notes\": \"Paciente pedi√°trica para control de crecimiento y desarrollo\",\n  \"requiresFollowUp\": true,\n  \"followUpDate\": \"2025-03-16T14:00:00.000Z\",\n  \"followUpPriority\": \"NORMAL\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/appointments",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"appointments"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Pediatric appointment created successfully\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"if (pm.response.code === 201) {",
									"    var jsonData = pm.response.json();",
									"    pm.globals.set(\"pediatricAppointmentId\", jsonData.data.id);",
									"    ",
									"    pm.test(\"Pediatric appointment has correct configuration\", function () {",
									"        pm.expect(jsonData.data.appointmentType).to.equal('follow_up');",
									"        pm.expect(jsonData.data.appointmentStatus).to.equal('scheduled');",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "‚ùå Create Appointment - Conflict Schedule",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"patientId\": \"{{patientId}}\",\n  \"medicId\": \"{{medicId}}\",\n  \"dateTime\": \"2024-12-15T10:00:00.000Z\",\n  \"appointmentType\": \"emergency\",\n  \"appointmentStatus\": \"pending\",\n  \"reason\": \"Cita en horario ocupado\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/appointments",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"appointments"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 409 Conflict\", function () {",
									"    pm.response.to.have.status(409);",
									"});",
									"",
									"pm.test(\"Error message about schedule conflict\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', false);",
									"    pm.expect(jsonData.message.toLowerCase()).to.include('conflict');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "‚ùå Create Appointment - Past Date",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"patientId\": \"{{patientId}}\",\n  \"medicId\": \"{{medicId}}\",\n  \"dateTime\": \"2023-01-01T10:00:00.000Z\",\n  \"appointmentType\": \"first_time\",\n  \"appointmentStatus\": \"pending\",\n  \"reason\": \"Cita en fecha pasada\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/appointments",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"appointments"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 400 Bad Request\", function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test(\"Error message about past date\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', false);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "‚úÖ Get Appointments - By Status",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/appointments?appointmentStatus=completed&appointmentType=first_time&requiresFollowUp=true",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"appointments"
							],
							"query": [
								{
									"key": "appointmentStatus",
									"value": "completed"
								},
								{
									"key": "appointmentType",
									"value": "first_time"
								},
								{
									"key": "requiresFollowUp",
									"value": "true"
								}
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"All appointments match filter criteria\", function () {",
									"    var jsonData = pm.response.json();",
									"    jsonData.data.forEach(function(appointment) {",
									"        pm.expect(appointment.appointmentStatus).to.equal('completed');",
									"        pm.expect(appointment.appointmentType).to.equal('first_time');",
									"        pm.expect(appointment.requiresFollowUp).to.be.true;",
									"    });",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "‚úÖ Get Appointments - By Date Range",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/appointments?dateFrom=2024-12-01&dateTo=2024-12-31&medicId={{medicId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"appointments"
							],
							"query": [
								{
									"key": "dateFrom",
									"value": "2024-12-01"
								},
								{
									"key": "dateTo",
									"value": "2024-12-31"
								},
								{
									"key": "medicId",
									"value": "{{medicId}}"
								}
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"All appointments are within date range\", function () {",
									"    var jsonData = pm.response.json();",
									"    var startDate = new Date('2024-12-01');",
									"    var endDate = new Date('2024-12-31');",
									"    ",
									"    jsonData.data.forEach(function(appointment) {",
									"        var appointmentDate = new Date(appointment.dateTime);",
									"        pm.expect(appointmentDate >= startDate).to.be.true;",
									"        pm.expect(appointmentDate <= endDate).to.be.true;",
									"        pm.expect(appointment.medicId).to.equal(pm.globals.get('medicId'));",
									"    });",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "‚úÖ Get Appointments - By Patient",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/appointments?patientId={{patientId}}&sortBy=dateTime&sortOrder=desc",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"appointments"
							],
							"query": [
								{
									"key": "patientId",
									"value": "{{patientId}}"
								},
								{
									"key": "sortBy",
									"value": "dateTime"
								},
								{
									"key": "sortOrder",
									"value": "desc"
								}
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"All appointments belong to the patient\", function () {",
									"    var jsonData = pm.response.json();",
									"    jsonData.data.forEach(function(appointment) {",
									"        pm.expect(appointment.patientId).to.equal(pm.globals.get('patientId'));",
									"    });",
									"});",
									"",
									"pm.test(\"Appointments sorted by date descending\", function () {",
									"    var jsonData = pm.response.json();",
									"    if (jsonData.data.length > 1) {",
									"        for (let i = 1; i < jsonData.data.length; i++) {",
									"            var date1 = new Date(jsonData.data[i-1].dateTime);",
									"            var date2 = new Date(jsonData.data[i].dateTime);",
									"            pm.expect(date1 >= date2).to.be.true;",
									"        }",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				}
			]
		},
		{
			"name": "üß™ Integration Tests - Patient Care Workflow",
			"description": "Pruebas de flujos completos de atenci√≥n m√©dica",
			"item": [
				{
					"name": "üîÑ Complete Patient Care Journey",
					"item": [
						{
							"name": "Step 1 - Create Elderly Patient",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"firstName\": \"Roberto\",\n  \"lastName\": \"Silva\",\n  \"email\": \"roberto.silva@email.com\",\n  \"phone\": \"+1777888999\",\n  \"dateOfBirth\": \"1950-08-10\",\n  \"gender\": \"male\",\n  \"address\": \"Residencial Los √Ålamos 789\",\n  \"emergencyContact\": \"Mar√≠a Silva - +1777888998\",\n  \"medicalHistory\": \"Diabetes tipo 2, hipertensi√≥n arterial\",\n  \"allergies\": \"Al√©rgico a sulfonamidas\",\n  \"bloodType\": \"B+\",\n  \"active\": true\n}"
								},
								"url": {
									"raw": "{{baseUrl}}/patients",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"patients"
									]
								}
							},
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Elderly patient created successfully\", function () {",
											"    pm.response.to.have.status(201);",
											"});",
											"",
											"if (pm.response.code === 201) {",
											"    var jsonData = pm.response.json();",
											"    pm.globals.set(\"elderlyPatientId\", jsonData.data.id);",
											"    ",
											"    pm.test(\"Patient is elderly (over 65)\", function () {",
											"        var birthDate = new Date(jsonData.data.dateOfBirth);",
											"        var today = new Date();",
											"        var age = today.getFullYear() - birthDate.getFullYear();",
											"        pm.expect(age).to.be.above(65);",
											"    });",
											"    ",
											"    pm.test(\"Patient has chronic conditions documented\", function () {",
											"        pm.expect(jsonData.data.medicalHistory).to.include('Diabetes');",
											"        pm.expect(jsonData.data.medicalHistory).to.include('hipertensi√≥n');",
											"    });",
											"}"
										],
										"type": "text/javascript"
									}
								}
							]
						},
						{
							"name": "Step 2 - Create Specialist (Endocrinologist)",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"firstName\": \"Dr. Luis\",\n  \"lastName\": \"Mendoza\",\n  \"email\": \"luis.mendoza@hospital.com\",\n  \"phone\": \"+1333444555\",\n  \"specialty\": \"Endocrinolog√≠a\",\n  \"licenseNumber\": \"MED-99999\",\n  \"yearsOfExperience\": 15,\n  \"education\": \"Universidad de Medicina - Especializaci√≥n en Endocrinolog√≠a y Diabetes\",\n  \"certifications\": [\"Endocrinolog√≠a\", \"Diabetolog√≠a\", \"Metabolismo\"],\n  \"languagesSpoken\": [\"Espa√±ol\", \"Ingl√©s\"],\n  \"consultationFee\": 200.00,\n  \"biography\": \"Especialista en diabetes y trastornos endocrinos\",\n  \"active\": true\n}"
								},
								"url": {
									"raw": "{{baseUrl}}/medics",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"medics"
									]
								}
							},
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Endocrinologist created successfully\", function () {",
											"    pm.response.to.have.status(201);",
											"});",
											"",
											"if (pm.response.code === 201) {",
											"    var jsonData = pm.response.json();",
											"    pm.globals.set(\"endocrinologistId\", jsonData.data.id);",
											"    ",
											"    pm.test(\"Specialist has appropriate experience and fees\", function () {",
											"        pm.expect(jsonData.data.specialty).to.equal('Endocrinolog√≠a');",
											"        pm.expect(jsonData.data.yearsOfExperience).to.equal(15);",
											"        pm.expect(jsonData.data.consultationFee).to.equal(200);",
											"    });",
											"}"
										],
										"type": "text/javascript"
									}
								}
							]
						},
						{
							"name": "Step 3 - Schedule Diabetes Consultation",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"patientId\": \"{{elderlyPatientId}}\",\n  \"medicId\": \"{{endocrinologistId}}\",\n  \"dateTime\": \"2024-12-20T09:00:00.000Z\",\n  \"appointmentType\": \"specialty\",\n  \"appointmentStatus\": \"scheduled\",\n  \"reason\": \"Control de diabetes tipo 2 y ajuste de medicaci√≥n\",\n  \"notes\": \"Paciente con diabetes tipo 2 descompensada, requiere evaluaci√≥n de tratamiento actual\",\n  \"requiresFollowUp\": true,\n  \"followUpDate\": \"2025-01-20T09:00:00.000Z\",\n  \"followUpPriority\": \"HIGH\"\n}"
								},
								"url": {
									"raw": "{{baseUrl}}/appointments",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"appointments"
									]
								}
							},
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Diabetes consultation scheduled\", function () {",
											"    pm.response.to.have.status(201);",
											"});",
											"",
											"if (pm.response.code === 201) {",
											"    var jsonData = pm.response.json();",
											"    pm.globals.set(\"diabetesConsultationId\", jsonData.data.id);",
											"    ",
											"    pm.test(\"Consultation configured for high-priority follow-up\", function () {",
											"        pm.expect(jsonData.data.appointmentType).to.equal('specialty');",
											"        pm.expect(jsonData.data.appointmentStatus).to.equal('scheduled');",
											"        pm.expect(jsonData.data.followUpPriority).to.equal('HIGH');",
											"        pm.expect(jsonData.data.requiresFollowUp).to.be.true;",
											"    });",
											"}"
										],
										"type": "text/javascript"
									}
								}
							]
						},
						{
							"name": "Step 4 - Complete Consultation",
							"request": {
								"method": "PATCH",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"appointmentStatus\": \"completed\",\n  \"notes\": \"Consulta completada. Diagn√≥stico: Diabetes tipo 2 descompensada. Tratamiento: Ajuste de metformina a 850mg c/12h, inicio de insulina glargina. Control en 1 mes. Paciente requiere seguimiento estricto.\"\n}"
								},
								"url": {
									"raw": "{{baseUrl}}/appointments/{{diabetesConsultationId}}",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"appointments",
										"{{diabetesConsultationId}}"
									]
								}
							},
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Consultation completed successfully\", function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test(\"Completed consultation ready for follow-up process\", function () {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.data.appointmentStatus).to.equal('completed');",
											"    pm.expect(jsonData.data.notes).to.include('seguimiento estricto');",
											"    pm.expect(jsonData.data.requiresFollowUp).to.be.true;",
											"    pm.expect(jsonData.data.followUpPriority).to.equal('HIGH');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							]
						},
						{
							"name": "Step 5 - Verify Patient Care Workflow",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{baseUrl}}/appointments?patientId={{elderlyPatientId}}&appointmentStatus=completed&requiresFollowUp=true",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"appointments"
									],
									"query": [
										{
											"key": "patientId",
											"value": "{{elderlyPatientId}}"
										},
										{
											"key": "appointmentStatus",
											"value": "completed"
										},
										{
											"key": "requiresFollowUp",
											"value": "true"
										}
									]
								}
							},
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Patient care workflow verification successful\", function () {",
											"    pm.response.to.have.status(200);",
											"    var jsonData = pm.response.json();",
											"    ",
											"    pm.expect(jsonData.data.length).to.be.above(0);",
											"    ",
											"    // Verificar que hay al menos una cita completada que requiere seguimiento",
											"    var hasCompletedFollowUpAppointment = jsonData.data.some(appointment => ",
											"        appointment.appointmentStatus === 'completed' && ",
											"        appointment.requiresFollowUp === true &&",
											"        appointment.followUpPriority === 'HIGH'",
											"    );",
											"    ",
											"    pm.expect(hasCompletedFollowUpAppointment, 'Should have completed appointment requiring follow-up').to.be.true;",
											"    ",
											"    console.log('‚úÖ Complete Patient Care Journey test passed:');",
											"    console.log('- Elderly patient with chronic conditions created');",
											"    console.log('- Specialist endocrinologist created');",
											"    console.log('- High-priority specialty consultation scheduled');",
											"    console.log('- Consultation completed with follow-up requirements');",
											"    console.log('- Patient ready for follow-up tracking system');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							]
						}
					]
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Pre-request script global",
					"console.log('üöÄ Starting request to: ' + pm.request.url);",
					"",
					"// Log current variables for debugging",
					"if (pm.globals.has('patientId')) {",
					"    console.log('üè• Current Patient ID: ' + pm.globals.get('patientId'));",
					"}",
					"if (pm.globals.has('medicId')) {",
					"    console.log('üë®‚Äç‚öïÔ∏è Current Medic ID: ' + pm.globals.get('medicId'));",
					"}",
					"if (pm.globals.has('appointmentId')) {",
					"    console.log('üìÖ Current Appointment ID: ' + pm.globals.get('appointmentId'));",
					"}"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Global test script - runs after every request",
					"pm.test('‚è±Ô∏è  Response time is acceptable', function () {",
					"    pm.expect(pm.response.responseTime).to.be.below(5000);",
					"});",
					"",
					"pm.test('üì¶ Content-Type is application/json', function () {",
					"    if (pm.response.code !== 204) { // No Content responses don't have content-type",
					"        pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
					"    }",
					"});",
					"",
					"// Log response for failed requests",
					"if (pm.response.code >= 400) {",
					"    console.log('‚ùå Request failed with status: ' + pm.response.code);",
					"    console.log('üìÑ Response body: ' + pm.response.text());",
					"} else {",
					"    console.log('‚úÖ Request successful: ' + pm.response.code);",
					"}",
					"",
					"// Track state transitions for appointments",
					"if (pm.request.url.toString().includes('/appointments/') && pm.request.method === 'PATCH') {",
					"    try {",
					"        var requestBody = JSON.parse(pm.request.body.raw);",
					"        if (requestBody.appointmentStatus && pm.response.code === 200) {",
					"            console.log('üîÑ Appointment state transition to: ' + requestBody.appointmentStatus);",
					"        }",
					"    } catch (e) {",
					"        // Ignore parsing errors",
					"    }",
					"}"
				]
			}
		}
	],
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:3001/api/v1",
			"type": "string"
		},
		{
			"key": "bearerToken",
			"value": "your_jwt_token_here",
			"type": "string"
		}
	]
}