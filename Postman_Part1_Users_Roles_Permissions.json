{
	"info": {
		"_postman_id": "a1b2c3d4-5678-9012-3456-789012345678",
		"name": "Sistema MÃ©dico - Parte 1: Users, Roles & Permissions",
		"description": "ColecciÃ³n de pruebas para mÃ³dulos de usuarios, roles y permisos con validaciones de negocio y casos edge",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "ğŸ‘¥ Users Management",
			"description": "GestiÃ³n completa de usuarios con validaciones y casos de error",
			"item": [
				{
					"name": "âœ… Create User - Success",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{bearerToken}}",
								"disabled": true
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"Dr. Juan PÃ©rez\",\n  \"email\": \"juan.perez@hospital.com\",\n  \"password\": \"SecurePass123!\",\n  \"roleId\": 1\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/users",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"users"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201 Created\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Response has user data structure\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', true);",
									"    pm.expect(jsonData).to.have.property('data');",
									"    pm.expect(jsonData.data).to.have.property('id');",
									"    pm.expect(jsonData.data).to.have.property('name', 'Dr. Juan PÃ©rez');",
									"    pm.expect(jsonData.data).to.have.property('email', 'juan.perez@hospital.com');",
									"    pm.expect(jsonData.data).to.have.property('roleId');",
									"    pm.expect(jsonData.data).to.not.have.property('password');",
									"    ",
									"    // Guardar ID para siguientes requests",
									"    pm.globals.set(\"userId\", jsonData.data.id);",
									"});",
									"",
									"pm.test(\"Response has timestamp\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('timestamp');",
									"    pm.expect(jsonData.data).to.have.property('createdAt');",
									"    pm.expect(jsonData.data).to.have.property('updatedAt');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "âŒ Create User - Duplicate Email",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"Dr. Carlos RodrÃ­guez\",\n  \"email\": \"juan.perez@hospital.com\",\n  \"password\": \"AnotherPass123!\",\n  \"roleId\": 1\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/users",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"users"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 409 Conflict\", function () {",
									"    pm.response.to.have.status(409);",
									"});",
									"",
									"pm.test(\"Error message about duplicate email\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', false);",
									"    pm.expect(jsonData.message.toLowerCase()).to.include('email');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "âŒ Create User - Invalid Email",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"Dr. Ana GarcÃ­a\",\n  \"email\": \"invalid-email\",\n  \"password\": \"ValidPass123!\",\n  \"roleId\": 1\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/users",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"users"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 400 Bad Request\", function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test(\"Validation error for email format\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', false);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "âŒ Create User - Missing Required Fields",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"Dr. Sin Email\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/users",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"users"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 400 Bad Request\", function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test(\"Validation error for missing fields\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', false);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "âœ… Get All Users - With Pagination",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/users?page=1&limit=10&sortBy=name&sortOrder=asc",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"users"
							],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "limit",
									"value": "10"
								},
								{
									"key": "sortBy",
									"value": "name"
								},
								{
									"key": "sortOrder",
									"value": "asc"
								}
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has pagination structure\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', true);",
									"    pm.expect(jsonData).to.have.property('data');",
									"    pm.expect(jsonData).to.have.property('pagination');",
									"    pm.expect(jsonData.pagination).to.have.property('total');",
									"    pm.expect(jsonData.pagination).to.have.property('page');",
									"    pm.expect(jsonData.pagination).to.have.property('limit');",
									"    pm.expect(jsonData.pagination).to.have.property('pages');",
									"});",
									"",
									"pm.test(\"Data is an array\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data).to.be.an('array');",
									"});",
									"",
									"pm.test(\"Users are sorted by name ascending\", function () {",
									"    var jsonData = pm.response.json();",
									"    if (jsonData.data.length > 1) {",
									"        for (let i = 1; i < jsonData.data.length; i++) {",
									"            pm.expect(jsonData.data[i].name >= jsonData.data[i-1].name).to.be.true;",
									"        }",
									"    }",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "âœ… Get All Users - With Search",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/users?search=juan&sortBy=name&sortOrder=asc",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"users"
							],
							"query": [
								{
									"key": "search",
									"value": "juan"
								},
								{
									"key": "active",
									"value": "true"
								}
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Search results contain 'juan'\", function () {",
									"    var jsonData = pm.response.json();",
									"    if (jsonData.data.length > 0) {",
									"        jsonData.data.forEach(function(user) {",
									"            var searchMatch = user.name.toLowerCase().includes('juan') || ",
									"                            user.email.toLowerCase().includes('juan');",
									"            pm.expect(searchMatch).to.be.true;",
									"        });",
									"    }",
									"});",
									"",
									"pm.test(\"All users are active\", function () {",
									"    var jsonData = pm.response.json();",
									"    jsonData.data.forEach(function(user) {",
									"        pm.expect(user).to.have.property('roleId');",
									"    });",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "âœ… Get User by ID",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/users/{{userId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"users",
								"{{userId}}"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has correct user data\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', true);",
									"    pm.expect(jsonData.data).to.have.property('id', pm.globals.get('userId'));",
									"    pm.expect(jsonData.data).to.have.property('name');",
									"    pm.expect(jsonData.data).to.have.property('email');",
									"    pm.expect(jsonData.data).to.not.have.property('password');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "âŒ Get User by ID - Not Found",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/users/nonexistent-id-12345",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"users",
								"nonexistent-id-12345"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 404 Not Found\", function () {",
									"    pm.response.to.have.status(404);",
									"});",
									"",
									"pm.test(\"Error message indicates not found\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', false);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "âœ… Update User - Partial Update",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"Dr. Juan Carlos PÃ©rez\",\n  \"email\": \"juan.carlos@hospital.com\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/users/{{userId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"users",
								"{{userId}}"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"User data updated correctly\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', true);",
									"    pm.expect(jsonData.data).to.have.property('name', 'Dr. Juan Carlos PÃ©rez');",
									"    pm.expect(jsonData.data).to.have.property('roleId');",
									"});",
									"",
									"pm.test(\"UpdatedAt timestamp changed\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data).to.have.property('updatedAt');",
									"    pm.expect(new Date(jsonData.data.updatedAt) > new Date(jsonData.data.createdAt)).to.be.true;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "âŒ Update User - Duplicate Email",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"existing.email@hospital.com\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/users/{{userId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"users",
								"{{userId}}"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Solo verificar si es 409 si realmente hay email duplicado",
									"if (pm.response.code === 409) {",
									"    pm.test(\"Status code is 409 Conflict for duplicate email\", function () {",
									"        pm.response.to.have.status(409);",
									"    });",
									"} else {",
									"    pm.test(\"Update processed (no duplicate found)\", function () {",
									"        pm.expect([200, 404]).to.include(pm.response.code);",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					]
				}
			]
		},
		{
			"name": "ğŸ‘¤ Roles Management",
			"description": "GestiÃ³n de roles con permisos y validaciones de negocio",
			"item": [
				{
					"name": "âœ… Create Role - Success",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"MEDICO_GENERAL\",\n  \"description\": \"MÃ©dico con permisos bÃ¡sicos de consulta\",\n  \"isSystem\": false\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/roles",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"roles"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201 Created\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Response has role data structure\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', true);",
									"    pm.expect(jsonData).to.have.property('data');",
									"    pm.expect(jsonData.data).to.have.property('id');",
									"    pm.expect(jsonData.data).to.have.property('name', 'MÃ©dico General');",
									"    pm.expect(jsonData.data).to.have.property('description');",
									"    pm.expect(jsonData.data).to.have.property('roleId');",
									"    ",
									"    // Guardar ID para siguientes requests",
									"    pm.globals.set(\"roleId\", jsonData.data.id);",
									"});",
									"",
									"pm.test(\"Role has timestamps\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data).to.have.property('createdAt');",
									"    pm.expect(jsonData.data).to.have.property('updatedAt');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "âœ… Create Role - Admin Role",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"ADMINISTRADOR\",\n  \"description\": \"Rol con todos los permisos del sistema\",\n  \"isSystem\": true\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/roles",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"roles"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201 Created\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"if (pm.response.code === 201) {",
									"    var jsonData = pm.response.json();",
									"    pm.globals.set(\"adminRoleId\", jsonData.data.id);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "âŒ Create Role - Duplicate Name",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"MEDICO_GENERAL\",\n  \"description\": \"Intento de duplicar nombre de rol\",\n  \"isSystem\": false\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/roles",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"roles"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 409 Conflict\", function () {",
									"    pm.response.to.have.status(409);",
									"});",
									"",
									"pm.test(\"Error message about duplicate name\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', false);",
									"    pm.expect(jsonData.message.toLowerCase()).to.include('name');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "âœ… Get All Roles - With Pagination",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/roles?page=1&limit=10&sortBy=name&sortOrder=asc",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"roles"
							],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "limit",
									"value": "10"
								},
								{
									"key": "active",
									"value": "true"
								},
								{
									"key": "sortBy",
									"value": "name"
								},
								{
									"key": "sortOrder",
									"value": "asc"
								}
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has pagination structure\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', true);",
									"    pm.expect(jsonData).to.have.property('data');",
									"    pm.expect(jsonData).to.have.property('pagination');",
									"});",
									"",
									"pm.test(\"Roles have correct structure\", function () {",
									"    var jsonData = pm.response.json();",
									"    jsonData.data.forEach(function(role) {",
									"        pm.expect(role).to.have.property('isSystem');",
									"    });",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "âœ… Get Role by ID",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/roles/{{roleId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"roles",
								"{{roleId}}"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has correct role data\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', true);",
									"    pm.expect(jsonData.data).to.have.property('id', parseInt(pm.globals.get('roleId')));",
									"    pm.expect(jsonData.data).to.have.property('name');",
									"    pm.expect(jsonData.data).to.have.property('description');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "âœ… Get Role by Name",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/roles/name/MÃ©dico General",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"roles",
								"name",
								"MÃ©dico General"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Found role with correct name\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data).to.have.property('name', 'MÃ©dico General');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "âœ… Update Role",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"description\": \"MÃ©dico general con permisos actualizados\",\n  \"isSystem\": false\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/roles/{{roleId}}",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"roles",
								"{{roleId}}"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Role description updated\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data).to.have.property('description', 'MÃ©dico general con permisos actualizados');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "âœ… Bulk Create Roles",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "[\n  {\n    \"name\": \"ENFERMERO\",\n    \"description\": \"Personal de enfermerÃ­a\",\n    \"isSystem\": false\n  },\n  {\n    \"name\": \"RECEPCIONISTA\",\n    \"description\": \"Personal de recepciÃ³n\",\n    \"isSystem\": false\n  },\n  {\n    \"name\": \"ESPECIALISTA\",\n    \"description\": \"MÃ©dico especialista\",\n    \"isSystem\": false\n  }\n]"
						},
						"url": {
							"raw": "{{baseUrl}}/roles/bulk",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"roles",
								"bulk"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201 Created\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Multiple roles created\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', true);",
									"    pm.expect(jsonData.data).to.be.an('array');",
									"    pm.expect(jsonData.data.length).to.equal(3);",
									"});",
									"",
									"pm.test(\"All roles have required properties\", function () {",
									"    var jsonData = pm.response.json();",
									"    jsonData.data.forEach(function(role) {",
									"        pm.expect(role).to.have.property('id');",
									"        pm.expect(role).to.have.property('name');",
									"        pm.expect(role).to.have.property('description');",
									"        pm.expect(role).to.have.property('isSystem');",
									"    });",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				}
			]
		},
		{
			"name": "ğŸ” Permissions Management",
			"description": "GestiÃ³n de permisos del sistema con validaciones",
			"item": [
				{
					"name": "âœ… Create Permission - Read Patients",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"READ_PATIENTS\",\n  \"description\": \"Permiso para leer informaciÃ³n de pacientes\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/permissions",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"permissions"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201 Created\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Response has permission data structure\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', true);",
									"    pm.expect(jsonData).to.have.property('data');",
									"    pm.expect(jsonData.data).to.have.property('id');",
									"    pm.expect(jsonData.data).to.have.property('name', 'read_patients');",
									"    pm.expect(jsonData.data).to.have.property('resource', 'patients');",
									"    pm.expect(jsonData.data).to.have.property('action', 'read');",
									"    pm.expect(jsonData.data).to.have.property('roleId');",
									"    ",
									"    // Guardar ID para siguientes requests",
									"    pm.globals.set(\"permissionId\", jsonData.data.id);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "âœ… Bulk Create Permissions",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "[\n  {\n    \"name\": \"WRITE_PATIENTS\",\n    \"description\": \"Permiso para crear y modificar pacientes\"\n  },\n  {\n    \"name\": \"DELETE_PATIENTS\",\n    \"description\": \"Permiso para eliminar pacientes\"\n  },\n  {\n    \"name\": \"READ_APPOINTMENTS\",\n    \"description\": \"Permiso para leer citas mÃ©dicas\"\n  },\n  {\n    \"name\": \"WRITE_APPOINTMENTS\",\n    \"description\": \"Permiso para crear y modificar citas\"\n  },\n  {\n    \"name\": \"MANAGE_USERS\",\n    \"description\": \"Permiso para gestionar usuarios del sistema\"\n  }\n]"
						},
						"url": {
							"raw": "{{baseUrl}}/permissions/bulk",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"permissions",
								"bulk"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201 Created\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Multiple permissions created\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', true);",
									"    pm.expect(jsonData.data).to.be.an('array');",
									"    pm.expect(jsonData.data.length).to.equal(5);",
									"});",
									"",
									"// Guardar IDs de permisos para asignaciÃ³n a roles",
									"if (pm.response.code === 201) {",
									"    var jsonData = pm.response.json();",
									"    var permissionIds = jsonData.data.map(p => p.id);",
									"    pm.globals.set(\"permissionIds\", JSON.stringify(permissionIds));",
									"    ",
									"    // Guardar IDs especÃ­ficos",
									"    jsonData.data.forEach(function(permission) {",
									"        switch(permission.name) {",
									"            case 'write_patients':",
									"                pm.globals.set('writePermissionId', permission.id);",
									"                break;",
									"            case 'manage_users':",
									"                pm.globals.set('manageUsersPermissionId', permission.id);",
									"                break;",
									"        }",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "âŒ Create Permission - Duplicate Name",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"READ_PATIENTS\",\n  \"description\": \"Intento de duplicar permiso\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/permissions",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"permissions"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 409 Conflict\", function () {",
									"    pm.response.to.have.status(409);",
									"});",
									"",
									"pm.test(\"Error message about duplicate name\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', false);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "âœ… Get All Permissions",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/permissions?page=1&limit=20&search=patients&sortBy=name&sortOrder=asc",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"permissions"
							],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "limit",
									"value": "20"
								},
								{
									"key": "active",
									"value": "true"
								},
								{
									"key": "resource",
									"value": "patients"
								}
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"All permissions are for patients resource\", function () {",
									"    var jsonData = pm.response.json();",
									"    jsonData.data.forEach(function(permission) {",
									"        pm.expect(permission.resource).to.equal('patients');",
									"        pm.expect(permission).to.have.property('name');",
									"    });",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "âœ… Get Permission by Name",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/permissions/name/read_patients",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"permissions",
								"name",
								"read_patients"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Found permission with correct name\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data).to.have.property('name', 'read_patients');",
									"    pm.expect(jsonData.data).to.have.property('resource', 'patients');",
									"    pm.expect(jsonData.data).to.have.property('action', 'read');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				}
			]
		},
		{
			"name": "ğŸ”— Role-Permission Integration",
			"description": "Pruebas de asignaciÃ³n y gestiÃ³n de permisos en roles",
			"item": [
				{
					"name": "âœ… Assign Permissions to Role",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"permissionIds\": {{permissionIds}}\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/roles/{{roleId}}/permissions",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"roles",
								"{{roleId}}",
								"permissions"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Permissions assigned successfully\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', true);",
									"    pm.expect(jsonData.data).to.have.property('permissions');",
									"    pm.expect(jsonData.data.permissions).to.be.an('array');",
									"    pm.expect(jsonData.data.permissions.length).to.be.above(0);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "âœ… Get Role Permissions",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/roles/{{roleId}}/permissions",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"roles",
								"{{roleId}}",
								"permissions"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Role has assigned permissions\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', true);",
									"    pm.expect(jsonData.data).to.be.an('array');",
									"    pm.expect(jsonData.data.length).to.be.above(0);",
									"    ",
									"    // Verificar que cada permiso tiene la estructura correcta",
									"    jsonData.data.forEach(function(permission) {",
									"        pm.expect(permission).to.have.property('id');",
									"        pm.expect(permission).to.have.property('name');",
									"        pm.expect(permission).to.have.property('resource');",
									"        pm.expect(permission).to.have.property('action');",
									"    });",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "âœ… Remove Specific Permission from Role",
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"permissionIds\": [{{writePermissionId}}]\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/roles/{{roleId}}/permissions",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"roles",
								"{{roleId}}",
								"permissions"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Permission removed successfully\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', true);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				},
				{
					"name": "âŒ Assign Non-existent Permission to Role",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"permissionIds\": [99999, 88888]\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/roles/{{roleId}}/permissions",
							"host": [
								"{{baseUrl}}"
							],
							"path": [
								"roles",
								"{{roleId}}",
								"permissions"
							]
						}
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 400 Bad Request\", function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test(\"Error message about permissions not found\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('success', false);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					]
				}
			]
		},
		{
			"name": "ğŸ§ª Integration Tests - Complete Workflows",
			"description": "Pruebas de flujos completos de negocio",
			"item": [
				{
					"name": "ğŸ”„ Complete User-Role-Permission Workflow",
					"item": [
						{
							"name": "Step 1 - Create Admin User",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"name\": \"Sistema Administrador\",\n  \"email\": \"admin@sistema.com\",\n  \"password\": \"AdminPass123!\",\n  \"roleId\": 1\n}"
								},
								"url": {
									"raw": "{{baseUrl}}/users",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"users"
									]
								}
							},
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Admin user created successfully\", function () {",
											"    pm.response.to.have.status(201);",
											"});",
											"",
											"if (pm.response.code === 201) {",
											"    var jsonData = pm.response.json();",
											"    pm.globals.set(\"adminUserId\", jsonData.data.id);",
											"}"
										],
										"type": "text/javascript"
									}
								}
							]
						},
						{
							"name": "Step 2 - Assign Admin Role Full Permissions",
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"permissionIds\": [{{manageUsersPermissionId}}, {{permissionId}}]\n}"
								},
								"url": {
									"raw": "{{baseUrl}}/roles/{{adminRoleId}}/permissions",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"roles",
										"{{adminRoleId}}",
										"permissions"
									]
								}
							},
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Admin role permissions assigned\", function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test(\"Admin role has manage permissions\", function () {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.data.permissions).to.be.an('array');",
											"    pm.expect(jsonData.data.permissions.length).to.be.above(0);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							]
						},
						{
							"name": "Step 3 - Verify Admin Role Structure",
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{baseUrl}}/roles/{{adminRoleId}}/permissions",
									"host": [
										"{{baseUrl}}"
									],
									"path": [
										"roles",
										"{{adminRoleId}}",
										"permissions"
									]
								}
							},
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Workflow completed successfully\", function () {",
											"    pm.response.to.have.status(200);",
											"    var jsonData = pm.response.json();",
											"    ",
											"    // Verificar que el admin tiene permisos de gestiÃ³n",
											"    var hasManagePermission = jsonData.data.some(p => p.name === 'manage_users');",
											"    pm.expect(hasManagePermission, 'Admin should have manage_users permission').to.be.true;",
											"    ",
											"    console.log('âœ… Complete workflow test passed:');",
											"    console.log('- Admin user created');",
											"    console.log('- Admin role configured with permissions');",
											"    console.log('- Permission structure verified');",
											"});"
										],
										"type": "text/javascript"
									}
								}
							]
						}
					]
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Pre-request script global",
					"console.log('ğŸš€ Starting request to: ' + pm.request.url);",
					"",
					"// Log current variables for debugging",
					"if (pm.globals.has('userId')) {",
					"    console.log('ğŸ‘¤ Current User ID: ' + pm.globals.get('userId'));",
					"}",
					"if (pm.globals.has('roleId')) {",
					"    console.log('ğŸ‘¥ Current Role ID: ' + pm.globals.get('roleId'));",
					"}",
					"if (pm.globals.has('permissionId')) {",
					"    console.log('ğŸ” Current Permission ID: ' + pm.globals.get('permissionId'));",
					"}"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Global test script - runs after every request",
					"pm.test('â±ï¸  Response time is acceptable', function () {",
					"    pm.expect(pm.response.responseTime).to.be.below(5000);",
					"});",
					"",
					"pm.test('ğŸ“¦ Content-Type is application/json', function () {",
					"    if (pm.response.code !== 204) { // No Content responses don't have content-type",
					"        pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
					"    }",
					"});",
					"",
					"// Log response for failed requests",
					"if (pm.response.code >= 400) {",
					"    console.log('âŒ Request failed with status: ' + pm.response.code);",
					"    console.log('ğŸ“„ Response body: ' + pm.response.text());",
					"} else {",
					"    console.log('âœ… Request successful: ' + pm.response.code);",
					"}"
				]
			}
		}
	],
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:3001/api/v1",
			"type": "string"
		},
		{
			"key": "bearerToken",
			"value": "your_jwt_token_here",
			"type": "string"
		}
	]
}